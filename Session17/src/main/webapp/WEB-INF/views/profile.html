<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Trang cá nhân</title>
  <style>
    table {
      width: 90%;
      margin: auto;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
    }
    form {
      margin: 20px auto;
      width: 90%;
    }
    .profile-section {
      width: 90%;
      margin: auto;
      padding: 20px;
      border: 1px solid #ddd;
      margin-bottom: 40px;
    }
  </style>
</head>
<body>
<h2 style="text-align:center;">Thông tin cá nhân</h2>

<div class="profile-section">
  <form th:action="@{/profile/update}" method="post" th:object="${customer}">
    <label>Họ tên:</label>
    <input type="text" th:field="*{fullName}" required/>
    <br/><br/>

    <label>Email:</label>
    <input type="email" th:field="*{email}" readonly/>
    <br/><br/>

    <label>Số điện thoại:</label>
    <input type="text" th:field="*{phoneNumber}" required/>
    <br/><br/>

    <label>Địa chỉ:</label>
    <input type="text" th:field="*{address}" required/>
    <br/><br/>

    <button type="submit">Cập nhật thông tin</button>
  </form>
</div>

<h2 style="text-align:center;">Lịch sử đặt hàng</h2>
<table>
  <thead>
  <tr>
    <th>Mã đơn</th>
    <th>Ngày đặt</th>
    <th>Tổng tiền</th>
    <th>Trạng thái</th>
    <th>Hành động</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="order : ${ordersPage.content}">
    <td th:text="${order.id}"></td>
    <td th:text="${#dates.format(order.orderDate, 'dd/MM/yyyy')}"></td>
    <td th:text="${order.totalMoney} + ' đ'"></td>
    <td th:text="${order.status}"></td>
    <td>
      <form th:action="@{/profile/cancelOrder}" method="post" th:if="${order.status != 'Cancelled'}">
        <input type="hidden" name="orderId" th:value="${order.id}"/>
        <button type="submit" onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này?')">Hủy đơn</button>
      </form>
      <span th:if="${order.status == 'Cancelled'}">Đã hủy</span>
    </td>
  </tr>
  </tbody>
</table>

<!-- Phân trang -->
<div style="text-align:center; margin-top: 20px;">
  <a th:href="@{/profile(page=${currentPage > 0 ? currentPage - 1 : 0}, size=${pageSize})}"
     th:if="${currentPage > 0}">Trang trước</a>

  <span>Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${ordersPage.totalPages}"></span></span>

  <a th:href="@{/profile(page=${currentPage + 1 < ordersPage.totalPages ? currentPage + 1 : currentPage}, size=${pageSize})}"
     th:if="${currentPage + 1 < ordersPage.totalPages}">Trang sau</a>
</div>

</body>
</html>
