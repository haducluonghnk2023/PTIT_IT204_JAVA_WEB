<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${isEdit} ? 'Chỉnh sửa Hạt giống' : 'Thêm mới Hạt giống'">Hạt giống</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2 th:text="${isEdit} ? 'Chỉnh sửa Hạt giống' : 'Thêm mới Hạt giống'"></h2>

    <!-- Form cho Add -->
    <form th:if="${!isEdit}"
          th:action="@{/seeds/add}"
          th:object="${seedDTO}"
          method="post"
          enctype="multipart/form-data"
          class="mt-4">

        <!-- Tên hạt giống -->
        <div class="mb-3">
            <label for="seedName" class="form-label">Tên hạt giống</label>
            <input type="text" th:field="*{seedName}" class="form-control" id="seedName" >
            <div class="text-danger" th:if="${#fields.hasErrors('seedName')}" th:errors="*{seedName}"></div>
        </div>

        <!-- Mô tả -->
        <div class="mb-3">
            <label for="description" class="form-label">Mô tả</label>
            <textarea th:field="*{description}" class="form-control" id="description" rows="3" ></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
        </div>

        <!-- Giá -->
        <div class="mb-3">
            <label for="price" class="form-label">Giá (VNĐ)</label>
            <input type="number" th:field="*{price}" class="form-control" id="price" step="1000" min="0" >
            <div class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
        </div>

        <!-- Tồn kho -->
        <div class="mb-3">
            <label for="stock" class="form-label">Tồn kho</label>
            <input type="number" th:field="*{stock}" class="form-control" id="stock" min="0" >
            <div class="text-danger" th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"></div>
        </div>

        <!-- Ảnh (bắt buộc cho add) -->
        <div class="mb-3">
            <label for="file" class="form-label">Ảnh *</label>
            <input type="file" th:field="*{file}" class="form-control" id="file" accept="image/*" >
            <div class="text-danger" th:if="${#fields.hasErrors('file')}">Vui lòng chọn ảnh hợp lệ</div>
        </div>

        <!-- Thông báo lỗi chung -->
        <div th:if="${error != null}" class="alert alert-danger" th:text="${error}"></div>

        <button type="submit" class="btn btn-primary">Lưu mới</button>
        <a th:href="@{/seeds}" class="btn btn-secondary">Quay lại</a>
    </form>

    <!-- Form cho Edit -->
    <form th:if="${isEdit}"
          th:action="@{/seeds/edit/{id}(id=${seedId})}"
          th:object="${seedDTO}"
          method="post"
          enctype="multipart/form-data"
          class="mt-4">

        <!-- Tên hạt giống -->
        <div class="mb-3">
            <label for="seedNameEdit" class="form-label">Tên hạt giống</label>
            <input type="text" th:field="*{seedName}" class="form-control" id="seedNameEdit" >
            <div class="text-danger" th:if="${#fields.hasErrors('seedName')}" th:errors="*{seedName}"></div>
        </div>

        <!-- Mô tả -->
        <div class="mb-3">
            <label for="descriptionEdit" class="form-label">Mô tả</label>
            <textarea th:field="*{description}" class="form-control" id="descriptionEdit" rows="3" ></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
        </div>

        <!-- Giá -->
        <div class="mb-3">
            <label for="priceEdit" class="form-label">Giá (VNĐ)</label>
            <input type="number" th:field="*{price}" class="form-control" id="priceEdit" step="1000" min="0" >
            <div class="text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
        </div>

        <!-- Tồn kho -->
        <div class="mb-3">
            <label for="stockEdit" class="form-label">Tồn kho</label>
            <input type="number" th:field="*{stock}" class="form-control" id="stockEdit" min="0" >
            <div class="text-danger" th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"></div>
        </div>

        <!-- Hiển thị ảnh hiện tại -->
        <div class="mb-3" th:if="${imageUrl != null}">
            <label class="form-label">Ảnh hiện tại:</label><br>
            <img th:src="${imageUrl}" alt="Ảnh hiện tại" class="img-thumbnail" style="max-width: 200px;">
        </div>

        <!-- Ảnh (không bắt buộc cho edit) -->
        <div class="mb-3">
            <label for="fileEdit" class="form-label">Chọn ảnh mới (tùy chọn)</label>
            <input type="file" th:field="*{file}" class="form-control" id="fileEdit" accept="image/*">
            <small class="text-muted">Để trống nếu không muốn thay đổi ảnh</small>
            <div class="text-danger" th:if="${#fields.hasErrors('file')}">Vui lòng chọn ảnh hợp lệ</div>
        </div>

        <!-- Thông báo lỗi chung -->
        <div th:if="${error != null}" class="alert alert-danger" th:text="${error}"></div>

        <button type="submit" class="btn btn-primary">Cập nhật</button>
        <a th:href="@{/seeds}" class="btn btn-secondary">Quay lại</a>
    </form>
</div>

</body>
</html>